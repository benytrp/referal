{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Nvrstry Canonical Artifact",
  "type": "object",
  "properties": {
    "project_metadata": {
      "$ref": "#/$defs/ProjectMetadata"
    },
    "story_elements": {
      "$ref": "#/$defs/StoryElements"
    },
    "technical_details": {
      "$ref": "#/$defs/TechnicalDetails"
    },
    "version_control": {
      "$ref": "#/$defs/VersionControl"
    },
    "trigger": {
      "type": [
        "string",
        "null"
      ]
    },
    "contract": {
      "$ref": "#/$defs/Contract"
    },
    "phases": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Phase"
      }
    },
    "metadata": {
      "$ref": "#/$defs/Metadata"
    },
    "cycle_log": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/CycleLogEntry"
      }
    }
  },
  "additionalProperties": true,
  "$defs": {
    "ProjectMetadata": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string"
        },
        "logline": {
          "type": "string"
        },
        "project_id": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "StoryElements": {
      "type": "object",
      "properties": {
        "genre": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "themes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "setting": {
          "type": "object",
          "properties": {
            "primary_location": {
              "type": "string"
            },
            "time_period": {
              "type": "string"
            }
          },
          "additionalProperties": true
        },
        "characters": {
          "type": "object",
          "properties": {
            "protagonist": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "arc": {
                  "type": "string"
                }
              },
              "additionalProperties": true
            },
            "antagonist": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                }
              },
              "additionalProperties": true
            }
          },
          "additionalProperties": true
        },
        "plot": {
          "type": "object",
          "properties": {
            "inciting_incident": {
              "type": "string"
            },
            "climax": {
              "type": "string"
            },
            "resolution": {
              "type": "string"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "TechnicalDetails": {
      "type": "object",
      "properties": {
        "medium": {
          "type": "string"
        },
        "word_count_target": {
          "type": [
            "string",
            "number"
          ]
        },
        "status": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "VersionControl": {
      "type": "object",
      "properties": {
        "last_edited_by": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        }
      },
      "additionalProperties": true
    },
    "Contract": {
      "type": "object",
      "properties": {
        "goal": {
          "type": "string"
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "success_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    },
    "Phase": {
      "type": "object",
      "properties": {
        "phase_name": {
          "type": "string"
        },
        "operations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "op": {
                "type": "string"
              },
              "parameters": {
                "type": "object"
              }
            },
            "required": [
              "op"
            ],
            "additionalProperties": true
          }
        },
        "parallel_sandboxes": {
          "type": "boolean"
        },
        "entropy": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      },
      "required": [
        "phase_name"
      ],
      "additionalProperties": true
    },
    "Metadata": {
      "type": "object",
      "properties": {
        "created": {
          "type": "string",
          "format": "date-time"
        },
        "complexity_level": {
          "type": "string"
        },
        "risk_tolerance": {
          "type": "string"
        },
        "generator": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "CycleLogEntry": {
      "type": "object",
      "properties": {
        "cycle": {
          "type": [
            "integer",
            "string"
          ]
        },
        "phase": {
          "type": "string"
        },
        "op": {
          "type": "string"
        },
        "output": {},
        "contract_ref": {
          "type": [
            "string",
            "null"
          ]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "entropy": {
          "type": [
            "number",
            "null"
          ]
        },
        "contested": {
          "type": [
            "boolean",
            "null"
          ]
        },
        "hash_of_entry": {
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "cycle",
        "phase",
        "op",
        "output",
        "timestamp"
      ],
      "additionalProperties": true
    }
  }
}